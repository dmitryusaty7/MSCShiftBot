# MCSShiftBot

telegram-–±–æ—Ç –¥–ª—è —É—á—ë—Ç–∞ —Å–º–µ–Ω, –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ –∏ —Ä–∞—Å—Ö–æ–¥–æ–≤

---

## —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

- python 3.11+
- telegram bot token
- service account json –¥–ª—è google sheets —Å –ø—Ä–∞–≤–∞–º–∏ editor
- –¥–æ—Å—Ç—É–ø –∫ —Ü–µ–ª–µ–≤–æ–π google sheet (id –≤ .env)
- OAuth-—Ç–æ–∫–µ–Ω Yandex Disk —Å –ø—Ä–∞–≤–∞–º–∏ –Ω–∞ –ø–∞–ø–∫—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

---

## –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ (–±—ã—Å—Ç—Ä–æ)

```bash
# –∫–ª–æ–Ω–∏—Ä—É–µ—à—å –∏ –∑–∞—Ö–æ–¥–∏—à—å –≤ —Ä–µ–ø—É
git clone https://github.com/dmitryusaty7/mscshiftbot.git
cd mscshiftbot

# —Å–æ–∑–¥–∞—ë—à—å –≤–∏—Ä—Ç—É–∞–ª–∫—É
python -m venv .venv

# –∞–∫—Ç–∏–≤–∏—Ä—É–µ—à—å
# linux/mac
source .venv/bin/activate
# windows (powershell)
.venv\scripts\activate

# —Å—Ç–∞–≤–∏—à—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
python -m pip install -r requirements.txt
```

–ø–æ–º–µ—Å—Ç–∏ `service_account.json` –≤ –∫–æ—Ä–µ–Ω—å –ø—Ä–æ–µ–∫—Ç–∞. –Ω–µ –∫–æ–º–º–∏—Ç—å —Ñ–∞–π–ª. –¥–æ–±–∞–≤—å –≤ .gitignore.
—Å–∫–æ–ø–∏—Ä—É–π `.env.example` ‚Üí `.env` –∏ –∑–∞–ø–æ–ª–Ω–∏: `BOT_TOKEN`, `SPREADSHEET_ID`, `SERVICE_ACCOUNT_JSON_PATH` (–º–æ–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å —Å—Ç–∞—Ä–æ–µ –∏–º—è `GOOGLE_SERVICE_ACCOUNT_JSON_PATH`, –Ω–æ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –ø–µ—Ä–µ–π—Ç–∏ –Ω–∞ –Ω–æ–≤–æ–µ), –∞ —Ç–∞–∫–∂–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã `DRIVE_PROVIDER`, `YADISK_OAUTH_TOKEN`, `YADISK_ROOT_FOLDER`.

---

## –∑–∞–ø—É—Å–∫

–≤–∞—Ä–∏–∞–Ω—Ç a ‚Äî –∞–≤—Ç–æ–º–∞—Ç–æ–º (—Ä–µ–∫–æ–º–º–µ–Ω–¥–æ–≤–∞–Ω–æ):

```bash
./scripts/run_bot.sh
```

—Å–∫—Ä–∏–ø—Ç `scripts/run_bot.sh` —Ä–∞—Å—Å—á–∏—Ç–∞–Ω –Ω–∞ bash-–æ–∫—Ä—É–∂–µ–Ω–∏–µ (git bash, wsl, macos, linux).

–≤–∞—Ä–∏–∞–Ω—Ç b ‚Äî –≤—Ä—É—á–Ω—É—é:

```bash
python bot_shift.py
```

### windows launch

```powershell
powershell -ExecutionPolicy Bypass -File .\scripts\run_bot.ps1
```

—Å–∫—Ä–∏–ø—Ç `scripts/run_bot.ps1` –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è Windows PowerShell.

–≤ –∫–æ–Ω—Å–æ–ª–∏ –¥–æ–ª–∂–Ω–æ –ø–æ—è–≤–∏—Ç—å—Å—è: `bot polling is started` ‚Äî –∑–Ω–∞—á–∏—Ç live
–≤ telegram: @mscshiftbot ‚Üí /start

---

## —á—Ç–æ –¥–µ–ª–∞–µ—Ç —ç—Ç–æ—Ç —Ä–µ–ø–æ

- fsm-—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (—Ñ–∏–æ, –≤–∞–ª–∏–¥–∞—Ü–∏—è, –¥—É–±–ª–∏–∫–∞—Ç—ã)
- –∑–∞–ø–∏—Å—å –¥–∞–Ω–Ω—ã—Ö –≤ sheet: –ª–∏—Å—Ç `–¥a–Ω–Ω—ã–µ` (–¥–∏–∞–ø–∞–∑–æ–Ω a:g)
- –æ—Ç–¥–µ–ª—å–Ω—ã–µ –º–æ–¥—É–ª–∏ –¥–ª—è —Ä–∞—Å—Ö–æ–¥–æ–≤, –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤, —Å–æ—Å—Ç–∞–≤–∞ –±—Ä–∏–≥–∞–¥—ã
- sheets_service ‚Äî –µ–¥–∏–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∫ google sheets

---

## —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤

–§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–π –æ–±–ª–∞—Å—Ç–∏ –Ø–Ω–¥–µ–∫—Å.–î–∏—Å–∫–∞. –ö–∞–∂–¥—ã–π –¥–µ–Ω—å —Å–æ–∑–¥–∞—ë—Ç—Å—è –ø–∞–ø–∫–∞ `disk:/MSCShiftBot/–§–æ—Ç–æ–æ—Ç—á–µ—Ç - DD.MM.YYYY/`, –≤ –∫–æ—Ç–æ—Ä—É—é —Å–∫–ª–∞–¥—ã–≤–∞—é—Ç—Å—è —Ñ–∞–π–ª—ã –≤–∏–¥–∞ `HHMMSS_<telegram_id>_<nn>.jpg`. –ü–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –±–æ—Ç –ø—É–±–ª–∏–∫—É–µ—Ç –ø–∞–ø–∫—É –¥–Ω—è –∏ –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –ø—É–±–ª–∏—á–Ω—É—é —Å—Å—ã–ª–∫—É –≤ Google Sheets.

1. –ü–æ–ª—É—á–∏—Ç–µ OAuth-—Ç–æ–∫–µ–Ω —Å –ø—Ä–∞–≤–∞–º–∏ `cloud_api:disk.write` (–∏ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ `cloud_api:disk.read`). –°–∞–º—ã–π –±—ã—Å—Ç—Ä—ã–π —Å–ø–æ—Å–æ–± ‚Äî –ø–µ—Ä–µ–π—Ç–∏ –ø–æ —Å—Å—ã–ª–∫–µ `https://oauth.yandex.ru/authorize?response_type=token&client_id=<–≤–∞—à_client_id>` –∏ –≤—ã–¥–∞—Ç—å –ø—Ä–∞–≤–∞ –≤—ã–±—Ä–∞–Ω–Ω–æ–º—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é.
2. –í `.env` –∑–∞–¥–∞–π—Ç–µ `DRIVE_PROVIDER=yadisk`, `YADISK_OAUTH_TOKEN=<—Ç–æ–∫–µ–Ω>`, –ø—Ä–∏ –∂–µ–ª–∞–Ω–∏–∏ –∏–∑–º–µ–Ω–∏—Ç–µ –∫–æ—Ä–Ω–µ–≤—É—é –ø–∞–ø–∫—É —á–µ—Ä–µ–∑ `YADISK_ROOT_FOLDER` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `/MSCShiftBot`) –∏ –æ—Å—Ç–∞–≤—å—Ç–µ `YADISK_PUBLISH=true`, —á—Ç–æ–±—ã –±–æ—Ç –ø—É–±–ª–∏–∫–æ–≤–∞–ª –ø–∞–ø–∫—É –¥–Ω—è.
3. –ü–æ—Å–ª–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º –±–æ—Ç –∑–∞–≥—Ä—É–∂–∞–µ—Ç —Ñ–∞–π–ª—ã, –ø—É–±–ª–∏–∫—É–µ—Ç –ø–∞–ø–∫—É —Ç–µ–∫—É—â–µ–π –¥–∞—Ç—ã –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç `public_url` –≤ —Å—Ç–æ–ª–±–µ—Ü –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤. –°—Å—ã–ª–∫—É –º–æ–∂–Ω–æ –æ—Ç–∫—Ä—ã—Ç—å –±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏.

–ü—Ä–∏ –æ—à–∏–±–∫–∞—Ö –∑–∞–≥—Ä—É–∑–∫–∏ —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ç–æ–∫–µ–Ω –∞–∫—Ç–∏–≤–µ–Ω –∏ —É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –æ—Å—Ç–∞–ª–∏—Å—å –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø—Ä–∞–≤–∞ –Ω–∞ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –¥–∏—Å–∫–æ–º.

---

## –∑–∞–∫—Ä—ã—Ç–∏–µ —Å–º–µ–Ω—ã –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

- –∑–∞–ø–æ–ª–Ω—è–π—Ç–µ —Ä–∞–∑–¥–µ–ª—ã ¬´–†–∞—Å—Ö–æ–¥—ã¬ª, ¬´–ú–∞—Ç–µ—Ä–∏–∞–ª—ã¬ª –∏ ¬´–ë—Ä–∏–≥–∞–¥–∞¬ª. –∫–æ–≥–¥–∞ –≤—Å–µ –ø–æ–ª—è –≥–æ—Ç–æ–≤—ã, –≤ –º–µ–Ω—é —Å–º–µ–Ω—ã –ø–æ—è–≤–ª—è–µ—Ç—Å—è –∫–Ω–æ–ø–∫–∞ ¬´üîí –ó–∞–∫—Ä—ã—Ç—å —Å–º–µ–Ω—É¬ª.
- –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ –±–æ—Ç —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç –¥–∞—Ç—É –≤ –ª–∏—Å—Ç–µ ¬´–†–∞—Å—Ö–æ–¥—ã —Å–º–µ–Ω—ã¬ª, —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç —Å—á—ë—Ç—á–∏–∫ –∑–∞–∫—Ä—ã—Ç—ã—Ö —Å–º–µ–Ω –≤ –ª–∏—Å—Ç–µ ¬´–î–∞–Ω–Ω—ã–µ¬ª –∏ —Å–æ–±–∏—Ä–∞–µ—Ç —Ç–µ–∫—Å—Ç–æ–≤—É—é —Å–≤–æ–¥–∫—É.
- –≤ –ª–∏—á–∫—É –ø—Ä–∏—Ö–æ–¥–∏—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ, –∞ –≤ –≥—Ä—É–ø–ø–æ–≤–æ–π —á–∞—Ç –º–æ–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∏—Ç–æ–≥–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ (–≤–∫–ª—é—á–∞–µ—Ç—Å—è –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π `GROUP_NOTIFICATIONS`).
- —á—Ç–æ–±—ã –±–æ—Ç –∑–Ω–∞–ª, –∫—É–¥–∞ —Å–ª–∞—Ç—å —Å–≤–æ–¥–∫—É, —É–∫–∞–∂–∏—Ç–µ `GROUP_CHAT_ID` (–Ω–∞–ø—Ä–∏–º–µ—Ä, `-1001234567890`) –∏ –≤—ã—Å—Ç–∞–≤—å—Ç–µ `GROUP_NOTIFICATIONS=true`.
- –µ—Å–ª–∏ —á–∞—Ç –Ω–µ –∑–∞–¥–∞–Ω –∏–ª–∏ —Ä–∞—Å—Å—ã–ª–∫–∞ –æ—Ç–∫–ª—é—á–µ–Ω–∞, —Å–º–µ–Ω–∞ –≤—Å—ë —Ä–∞–≤–Ω–æ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è, –ø—Ä–æ—Å—Ç–æ –±–µ–∑ –≥—Ä—É–ø–ø–æ–≤–æ–≥–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è.

---

## –ø—Ä–∞–≤–∏–ª–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ (–¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞)

- –ø—Ä–æ–≤–µ—Ä—è—Ç—å —Ç–æ–ª—å–∫–æ –∫–æ–ª–æ–Ω–∫—É a (telegram id) –ø—Ä–∏ –ø–æ–∏—Å–∫–µ —Å—Ç—Ä–æ–∫–∏
- –∑–∞–ø–∏—Å—ã–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ –≤ –ø–µ—Ä–≤—É—é –ø—É—Å—Ç—É—é a
- —Å—Ç–∞—Ç—É—Å –≤ –∫–æ–ª–æ–Ω–∫–µ g = "–∞–∫—Ç–∏–≤–µ–Ω" –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
- –µ—Å–ª–∏ –≤ g —Å—Ç–æ–∏—Ç "–∞—Ä—Ö–∏–≤" ‚Äî reject, –ø–æ–∫–∞–∑–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –±–ª–æ–∫–µ
- –Ω–µ —Ç—Ä–æ–≥–∞—Ç—å –∫–æ–ª–æ–Ω–∫–∏ h:m
- –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å —Ñ–∏–æ: –ø–µ—Ä–≤–∞—è –±—É–∫–≤–∞ –∑–∞–≥–ª–∞–≤–Ω–∞—è, –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Å—Ç—Ä–æ—á–Ω—ã–µ
- –∑–∞–ø—Ä–µ—â–∞—Ç—å —Ü–∏—Ñ—Ä—ã –∏ —Å–ø–µ—Ü—Å–∏–º–≤–æ–ª—ã –≤ —Ñ–∏–æ
- –ø—Ä–æ–≤–µ—Ä—è—Ç—å –¥—É–±–ª–∏–∫–∞—Ç –ø–æ –ø–æ–ª–Ω–æ–º—É —Ñ–∏–æ —Å—Ä–µ–¥–∏ –∑–∞–ø–∏—Å–µ–π —Å g == "–∞–∫—Ç–∏–≤–µ–Ω"

---

## —Ç–µ—Å—Ç—ã –∏ –¥–µ–±–∞–≥

- –ª–æ–∫–∞–ª—å–Ω–æ: `log_level=debug python bot_shift.py`
- unit-tests: –ø–æ–∫—Ä—ã—Ç—å sheets_service (mocks –¥–ª—è gspread)
- —Ä—É—á–Ω–æ–π —á–µ–∫: —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è ‚Üí –∑–∞–ø–∏—Å—å a:g ‚Üí —Å–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤–æ–π —Å–º–µ–Ω—ã

---

## –∑–∞–º–µ—Ç–∫–∏ –ø–æ –¥–µ–ø–ª–æ—é

- –Ω–µ —Ö—Ä–∞–Ω–∏—Ç—å `service_account.json` –≤ —Ä–µ–ø–æ
- –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å env-vars –≤ CI (CI secret: SERVICE_ACCOUNT_JSON_BASE64)
- –ø—Ä–∏ –¥–µ–ø–ª–æ–µ: —Ä–∞—Å–∫–æ–¥–∏—Ä–æ–≤–∞—Ç—å base64 ‚Üí –≤—Ä–µ–º–µ–Ω–Ω—ã–π json, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Credentials.from_service_account_info

---

## quick commands

```bash
# –æ–±–Ω–æ–≤–∏—Ç—å main –∏–∑ remote
git checkout main && git pull origin main

# —Å–æ–±—Ä–∞—Ç—å –æ–∫—Ä—É–∂–µ–Ω–∏–µ –∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å
python -m venv .venv && source .venv/bin/activate && python -m pip install -r requirements.txt && python bot_shift.py
```

