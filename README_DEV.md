# README_DEV

## –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ —Å–º–µ–Ω–µ

–õ–æ–≥–∏–∫–∞ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è —Å–º–µ–Ω—ã —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –ø–æ –ø—Ä–∏–Ω—Ü–∏–ø—É ¬´hub state¬ª: –≤—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
–ø–æ–ø–∞–¥–∞—é—Ç –≤ —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–æ–µ –º–µ–Ω—é `ShiftState.ACTIVE`, –æ—Ç–∫—É–¥–∞ –æ—Ç–∫—Ä—ã–≤–∞—é—Ç –æ—Ç–¥–µ–ª—å–Ω—ã–µ
—Ä–µ–∂–∏–º—ã. –í–æ–∑–≤—Ä–∞—Ç –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é –ø–µ—Ä–µ–≤–æ–¥–∏—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ `ShiftState.IDLE`.

```
ShiftState.IDLE (–≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é)
      ‚îÇ
      ‚îú‚îÄ ¬´üöÄ –ù–∞—á–∞—Ç—å –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ —Å–º–µ–Ω—ã¬ª ‚Üí –ø—Ä–æ–≤–µ—Ä–∫–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –ø–æ –¥–∞—Ç–µ
      ‚îÇ         ‚îÇ
      ‚îÇ         ‚ñº
      ‚îÇ   ShiftState.ACTIVE (–º–µ–Ω—é —Å–º–µ–Ω—ã)
      ‚îÇ         ‚îÇ
      ‚îÇ         ‚îú‚îÄ ¬´üßæ –†–∞—Å—Ö–æ–¥—ã¬ª     ‚Üí Mode.EXPENSES ‚Üí ExpenseFSM‚Ä¶ ‚Üí –º–µ–Ω—é —Å–º–µ–Ω—ã
      ‚îÇ         ‚îú‚îÄ ¬´üì¶ –ú–∞—Ç–µ—Ä–∏–∞–ª—ã¬ª   ‚Üí Mode.MATERIALS ‚Üí MaterialsFSM‚Ä¶ ‚Üí –º–µ–Ω—é —Å–º–µ–Ω—ã
      ‚îÇ         ‚îî‚îÄ ¬´üë• –ë—Ä–∏–≥–∞–¥–∞¬ª     ‚Üí Mode.CREW ‚Üí CrewStates‚Ä¶ ‚Üí –º–µ–Ω—é —Å–º–µ–Ω—ã
      ‚îÇ
      ‚îî‚îÄ ¬´‚úÖ –ó–∞–∫–æ–Ω—á–∏—Ç—å —Å–º–µ–Ω—É¬ª (–¥–æ—Å—Ç—É–ø–Ω–∞ –ø–æ—Å–ª–µ ‚úÖ –ø–æ –≤—Å–µ–º —Ä–µ–∂–∏–º–∞–º)
                ‚îÇ
                ‚ñº
          –§–∏–Ω–∞–ª—å–Ω–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ + –≤–æ–∑–≤—Ä–∞—Ç –≤ ShiftState.IDLE
```

### –ú–µ–Ω—é —Å–º–µ–Ω—ã

* Inline-–∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç JSON payload:
  * `{"a":"open_mode","m":"expenses"}` ‚Äì –æ—Ç–∫—Ä—ã—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Ä–∞–∑–¥–µ–ª.
  * `{"a":"finish_shift"}` ‚Äì –∑–∞–ø—Ä–æ—Å –Ω–∞ –∑–∞–∫—Ä—ã—Ç–∏–µ —Å–º–µ–Ω—ã.
  * `{"a":"shift_menu","m":"home"}` ‚Äì –≤–æ–∑–≤—Ä–∞—Ç –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é.
* –°–æ–æ–±—â–µ–Ω–∏–µ –º–µ–Ω—é —Å–æ–¥–µ—Ä–∂–∏—Ç —á–µ–∫-–ª–∏—Å—Ç —Å —Ç–µ–∫—É—â–∏–º —Å—Ç–∞—Ç—É—Å–æ–º —Ä–∞–∑–¥–µ–ª–æ–≤.
* –ö–Ω–æ–ø–∫–∞ ¬´‚úÖ –ó–∞–∫–æ–Ω—á–∏—Ç—å —Å–º–µ–Ω—É¬ª –ø–æ—è–≤–ª—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –≤—Å–µ —Ä–∞–∑–¥–µ–ª—ã –æ—Ç–º–µ—á–µ–Ω—ã –∫–∞–∫
  –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ (`modes.expenses/materials/crew == True`) –∏ —Å–º–µ–Ω–∞ –µ—â—ë –Ω–µ
  –∑–∞–∫—Ä—ã—Ç–∞.

### –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ ¬´–æ–¥–Ω–∞ —Å–º–µ–Ω–∞ –≤ —Å—É—Ç–∫–∏¬ª

* –ü–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º –∏–ª–∏ –ø–æ–≤—Ç–æ—Ä–Ω—ã–º –æ—Ç–∫—Ä—ã—Ç–∏–µ–º —Å–º–µ–Ω—ã –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è
  `SheetsService.check_today_shift_lock(telegram_id)`. –ï—Å–ª–∏ –≤ –ª–∏—Å—Ç–µ ¬´–†–∞—Å—Ö–æ–¥—ã
  —Å–º–µ–Ω—ã¬ª —É–∂–µ —Å—Ç–æ–∏—Ç –æ—Ç–º–µ—Ç–∫–∞ –∑–∞–∫—Ä—ã—Ç–∏—è –ø–æ —Ç–µ–∫—É—â–µ–π –¥–∞—Ç–µ, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç
  —Å–æ–æ–±—â–µ–Ω–∏–µ ¬´–°–º–µ–Ω–∞ —É–∂–µ –∑–∞–∫—Ä—ã—Ç–∞ —Å–µ–≥–æ–¥–Ω—è¬ª –∏ –æ—Å—Ç–∞—ë—Ç—Å—è –≤ `ShiftState.IDLE`.
* –ü—Ä–∏ —É—Å–ø–µ—à–Ω–æ–º –∑–∞–∫—Ä—ã—Ç–∏–∏ —Å–º–µ–Ω—ã `SheetsService.finalize_shift` –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç
  –≤—Ä–µ–º–µ–Ω–Ω—É—é –º–µ—Ç–∫—É –≤ –∫–æ–ª–æ–Ω–∫—É `–†–∞—Å—Ö–æ–¥—ã —Å–º–µ–Ω—ã!L` –∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç –∫–µ—à, —á—Ç–æ –∏—Å–∫–ª—é—á–∞–µ—Ç
  –ø–æ–≤—Ç–æ—Ä–Ω–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ –≤ —ç—Ç–æ—Ç –∂–µ –¥–µ–Ω—å.

### –ü—Ä–æ–≥—Ä–µ—Å—Å –∏ –∫–µ—à

* –î–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Ö—Ä–∞–Ω–∏—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞
  `{date, row, modes, closed}`. –û–Ω–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç—Å—è —Å —Ç–∞–±–ª–∏—Ü–µ–π –ø—Ä–∏ –∫–∞–∂–¥–æ–º
  –ø–æ–∫–∞–∑–µ –º–µ–Ω—é –∏ –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ —Ä–∞–∑–¥–µ–ª–æ–≤.
* –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –ø–æ–¥—Ä–µ–∂–∏–º–∞ –≤—ã–∑—ã–≤–∞–µ—Ç `mark_mode_done`, —á—Ç–æ –æ–±–Ω–æ–≤–ª—è–µ—Ç –∫–µ—à –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç
  –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –º–µ–Ω—é –±–µ–∑ –ø–æ—Ç–µ—Ä–∏ –¥–∞–Ω–Ω—ã—Ö.

### –ü–æ–≤–µ–¥–µ–Ω–∏–µ –∫–Ω–æ–ø–æ–∫ ¬´–ù–∞–∑–∞–¥¬ª

* –í–æ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö —Å—Ü–µ–Ω–∞—Ä–∏—è—Ö (`expenses`, `materials`, `crew`) –∫–Ω–æ–ø–∫–∞ ¬´üè† –í –º–µ–Ω—é¬ª
  –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≤ `ShiftState.IDLE` —á–µ—Ä–µ–∑ `show_menu` –∏ –æ—á–∏—â–∞–µ—Ç –∫–µ—à —Å–º–µ–Ω—ã.
* –ö–Ω–æ–ø–∫–∞ ¬´‚¨Ö –í –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é¬ª –∏–∑ –º–µ–Ω—é —Å–º–µ–Ω—ã –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–∫—Ä—ã–≤–∞–µ—Ç hub –∏ –ø–µ—Ä–µ–≤–æ–¥–∏—Ç
  –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –æ—Å–Ω–æ–≤–Ω—É—é –ø–∞–Ω–µ–ª—å.

## –°–≤–æ–¥–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π

* –ú–µ–Ω—é —Å–º–µ–Ω—ã –ø–µ—Ä–µ–≤–µ–¥–µ–Ω–æ –Ω–∞ inline-–∫–ª–∞–≤–∏–∞—Ç—É—Ä—É –∏ JSON payload.
* –î–æ–±–∞–≤–ª–µ–Ω—ã —Å–æ—Å—Ç–æ—è–Ω–∏—è `ShiftState`/`Mode` –∏ –µ–¥–∏–Ω—ã–π –∫–µ—à –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ —Å–º–µ–Ω—ã.
* –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ —Å–º–µ–Ω—ã –ø–æ –¥–∞—Ç–µ –∏ –æ—Ç–º–µ—Ç–∫–∞ –∑–∞–∫—Ä—ã—Ç–∏—è –≤ —Ç–∞–±–ª–∏—Ü–µ.
* –í—Å–µ —Ä–∞–∑–¥–µ–ª—ã —Ç–µ–ø–µ—Ä—å –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –º–µ–Ω—é —Å–º–µ–Ω—ã –ø–æ—Å–ª–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è.
* –§–∏–Ω–∞–ª—å–Ω–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ —Å–º–µ–Ω—ã –ø–µ—Ä–µ–≤–æ–¥–∏—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é –∏ –æ—á–∏—â–∞–µ—Ç
  –∫–µ—à.
